<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantity Usage Calculator</title>
    <script>
        function calculateAmpules() {
            // Get input values
            var stockDose = parseFloat(document.getElementById('stockDose').value); // mg or mcg per mL
            var dilutionVolume = parseFloat(document.getElementById('dilutionVolume').value); // Total volume after dilution (mL)
            var strengthPerAmpule = parseFloat(document.getElementById('strengthPerAmpule').value); // mg or mcg per ampule
            var infusionRate = parseFloat(document.getElementById('infusionRate').value); // Infusion rate in mL per hour
            var startTime = new Date(document.getElementById('startTime').value);
            var endTime = new Date(document.getElementById('endTime').value);

            // Validate inputs
            if (isNaN(stockDose) || isNaN(dilutionVolume) || isNaN(strengthPerAmpule) || isNaN(infusionRate) || 
                stockDose <= 0 || dilutionVolume <= 0 || strengthPerAmpule <= 0 || infusionRate <= 0) {
                alert("Please enter valid positive numbers for all fields.");
                return;
            }
            if (isNaN(startTime.getTime()) || isNaN(endTime.getTime())) {
                alert("Please enter valid start and end times.");
                return;
            }
            if (endTime <= startTime) {
                alert("End time must be after start time.");
                return;
            }

            // Calculate time difference in hours
            var timeDiff = (endTime - startTime) / (1000 * 60 * 60); // Convert milliseconds to hours

            // Calculate the final concentration of the diluted solution (mg or mcg per mL)
            var finalConcentration = stockDose / dilutionVolume; // Final concentration of diluted solution

            // Calculate the total amount infused in mg or mcg
            var totalInfusedAmount = timeDiff * infusionRate * finalConcentration; // Total dose infused

            // Calculate the number of ampules used
            var totalAmpulesUsed = totalInfusedAmount / strengthPerAmpule;

            // Display result
            document.getElementById('result').innerText = 'Total Ampules Used: ' + totalAmpulesUsed.toFixed(2);
        }
    </script>
</head>
<body>
    <h1>Quantity Usage Calculator</h1>

    <label for="stockDose">Stock Dose for the infusion (mg or mcg):</label>
    <input type="number" id="stockDose" step="0.01" required><br><br>

    <label for="dilutionVolume">Total Dilution Volume (mL): (Which you'll dilute the last dose)</label>
    <input type="number" id="dilutionVolume" step="0.01" required><br><br>

    <label for="strengthPerAmpule">Strength per Ampule (mg or mcg):</label>
    <input type="number" id="strengthPerAmpule" step="0.01" required><br><br>

    <label for="infusionRate">Infusion Rate (How many  mL per hour you'll infuse): </label>
    <input type="number" id="infusionRate" step="0.01" required><br><br>

    <label for="startTime">Start Time:</label>
    <input type="datetime-local" id="startTime" required><br><br>

    <label for="endTime">End Time:</label>
    <input type="datetime-local" id="endTime" required><br><br>

    <button onclick="calculateAmpules()">Calculate</button>

    <h2 id="result">Total Ampules Used: </h2>
</body>
</html>